# 主题切换功能测试指南

## 🎨 测试方式

应用现在提供了多种方式来测试主题切换功能：

### 1. 首页快速测试 ⚡

在首页底部有完整的主题测试区域：

#### 三个主题按钮
- **浅色** - 切换到浅色模式
- **深色** - 切换到深色模式
- **跟随系统** - 跟随系统主题

当前选中的主题按钮会显示为填充样式（实心），其他为轮廓样式（空心）。

#### 浮动按钮（右下角）
点击右下角的浮动按钮可以**循环切换**主题：
- 浅色 → 深色 → 跟随系统 → 浅色 ...

浮动按钮的图标会根据当前主题变化：
- ☀️ `light_mode` - 浅色模式
- 🌙 `dark_mode` - 深色模式
- 🔄 `brightness_auto` - 跟随系统

### 2. 主题设置页面 ⚙️

#### 从首页进入
点击首页的"打开主题设置页面"按钮

#### 从"我的"页面进入
1. 切换到"我的"标签页
2. 点击"主题设置"菜单项

#### 设置页面功能
- **跟随系统开关** - 开启后自动跟随系统主题
- **手动选择** - 浅色/深色模式选择
- **实时预览** - 切换后立即生效

## 🧪 测试场景

### 场景 1：快速切换测试
1. 打开应用到首页
2. 点击"浅色"按钮 → 观察界面变化
3. 点击"深色"按钮 → 观察界面变化
4. 点击"跟随系统"按钮 → 观察界面变化

### 场景 2：浮动按钮测试
1. 连续点击右下角浮动按钮
2. 观察主题循环切换：浅色 → 深色 → 跟随系统 → 浅色
3. 观察浮动按钮图标变化

### 场景 3：持久化测试
1. 切换到深色模式
2. 完全关闭应用
3. 重新打开应用
4. ✅ 应该保持深色模式

### 场景 4：跟随系统测试
1. 切换到"跟随系统"模式
2. 在系统设置中切换系统主题（浅色/深色）
3. ✅ 应用主题应该自动跟随系统变化

### 场景 5：页面导航测试
1. 在首页切换到深色模式
2. 导航到其他页面（消息、我的、详情页等）
3. ✅ 所有页面应该保持深色主题
4. 返回首页
5. ✅ 主题状态应该保持一致

### 场景 6：设置页面测试
1. 打开主题设置页面
2. 测试跟随系统开关
3. 测试手动选择浅色/深色
4. 观察选中状态指示（✓ 图标）
5. 返回首页
6. ✅ 主题应该已经改变

## 📱 UI 变化观察点

切换主题时，注意观察以下 UI 元素的变化：

### 浅色模式特征
- 背景：白色/浅色
- 文字：深色
- 按钮：蓝色主题
- 卡片：白色背景

### 深色模式特征
- 背景：深灰/黑色
- 文字：浅色/白色
- 按钮：调整后的蓝色
- 卡片：深色背景

### TDesign 组件
所有 TDesign 组件（按钮、输入框、对话框等）都会自动适配主题。

## 🐛 常见问题

### Q: 切换主题后某些页面没有变化？
A: 这是正常的，某些页面可能使用了硬编码的颜色。应该使用 `TDTheme.of(context)` 获取主题颜色。

### Q: 重启应用后主题没有保存？
A: 检查 GetStorage 是否正确初始化。查看控制台是否有错误日志。

### Q: 跟随系统不生效？
A: 确保：
1. 选择了"跟随系统"模式
2. 系统主题确实发生了变化
3. 应用在前台运行

### Q: 主题切换有延迟？
A: 这是正常的，因为需要：
1. 更新状态
2. 保存到本地存储
3. 重建 Widget 树

通常延迟在 100ms 以内，几乎感觉不到。

## 💡 开发提示

### 在代码中使用主题

```dart
// 读取当前主题模式
final currentMode = themeStore.themeMode.value;

// 监听主题变化
Watch((context) {
  final isDark = themeStore.themeMode.value == AppThemeMode.dark;
  return Text(isDark ? '深色' : '浅色');
})

// 切换主题
await themeStore.setLightMode();
await themeStore.setDarkMode();
await themeStore.setSystemMode();
```

### 获取主题颜色

```dart
// 使用 TDesign 主题颜色
final brandColor = TDTheme.of(context).brandNormalColor;
final textColor = TDTheme.of(context).fontGyColor1;
final bgColor = TDTheme.of(context).bgColorContainer;
```

### 响应式主题组件

```dart
Watch((context) {
  final theme = TDTheme.of(context);
  return Container(
    color: theme.bgColorContainer,
    child: Text(
      'Hello',
      style: TextStyle(color: theme.fontGyColor1),
    ),
  );
})
```

## 📊 性能指标

- **切换速度**: < 100ms
- **存储大小**: < 1KB
- **内存占用**: 可忽略
- **CPU 使用**: 可忽略

## ✅ 测试清单

- [ ] 浅色模式切换正常
- [ ] 深色模式切换正常
- [ ] 跟随系统模式正常
- [ ] 浮动按钮循环切换正常
- [ ] 主题持久化正常（重启应用）
- [ ] 所有页面主题一致
- [ ] TDesign 组件适配正常
- [ ] 主题设置页面功能正常
- [ ] Toast 提示显示正常
- [ ] 性能流畅无卡顿

## 🎉 完成！

现在您可以尽情测试主题切换功能了！如果发现任何问题，请查看：
- `.claude/rules/14-theme-configuration.md` - 主题配置文档
- `.claude/rules/15-get-storage.md` - GetStorage 使用指南
- `THEME_IMPLEMENTATION.md` - 实现总结
